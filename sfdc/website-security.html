<!DOCTYPE html>
<html lang="en" ng-app="app" ng-controller="MainCtrl">

<head>
  <meta charset="UTF-8">
  <title>{{appName}}</title>

  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <link rel="stylesheet" href="../css/navbar-green.css">
  <script src="../js/angular.min.js"></script>
  <script src="../js/data-markdown.user.js"></script>


  <script src="../bower_components/marked/marked.min.js"></script>
  <script src="../bower_components/angular-marked/dist/angular-marked.js"></script>

  <link rel="stylesheet" href="../reveal.js/css/reveal.css">
  <link rel="stylesheet" href="../reveal.js/css/theme/white.css" id="theme">

  <!-- Code syntax highlighting -->
  <link rel="stylesheet" href="../reveal.js/lib/css/zenburn.css">

  <!-- Printing and PDF exports -->
  <script>
    var link = document.createElement('link');
    link.rel = 'stylesheet';
    link.type = 'text/css';
    link.href = window.location.search.match(/print-pdf/gi) ? '../reveal.js/css/print/pdf.css' : '../reveal.js/css/print/paper.css';
    document.getElementsByTagName('head')[0].appendChild(link);
  </script>

  <!--[if lt IE 9]>
    		<script src="../reveal.js/lib/js/html5shiv.js"></script>
    		<![endif]-->

  <style>
    .reveal .slide-number {
      font-size: 0.5em;
    }

    .simg {
      border-radius: 10px;
      border: 1px;
    }

    .reveal section ul li,
    .reveal section p {
      font-size: .8em !important;
    }

    .reveal section pre code {
      font-size: 0.7em !important;
    }
  </style>


</head>

<body>


  <nav class="navbar navbar-default" role="navigation">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="javascript:void(0)">{{appName}}</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        <li class="active"><a href="#/home">Home</a></li>
      </ul>
      <ul class="nav navbar-nav">
        <li ><a href="/">Main</a></li>
      </ul>

      <div class="inner-addon right-addon navbar-form navbar-right">
        <i class="glyphicon glyphicon-search"></i>
        <input type="text" class="form-control" placeholder="Search" />
      </div>

      <ul class="nav navbar-nav navbar-right">
        <li class="dropdown ">
          <a href="javascript:void(0)" class="dropdown-toggle" data-toggle="dropdown" aria-expanded="false">Help <b class="caret"></b></a>
          <ul class="dropdown-menu">
            <li><a href="./help.html">Help Topics</a></li>
          </ul>
        </li>
      </ul>
    </div>
    <!-- /.navbar-collapse -->
  </nav>
  <!--
  <div class="container" ng-controller='MainCtrl'>
    <div marked src="'pevents.md'"></div>
  </div>
-->


  <div class="reveal">

    <!-- Any section element inside of this container is displayed as a slide -->
    <div class="slides">

      <section id="home">
        <h4>{{appName}}</h4>
       </section>

       <section>
         <h4>Video - What is Cross-Site Scripting (XSS) </h4>
       </h4>
       <ul>
         <li> <iframe height="450" width="800" data-src="https://www.youtube.com/embed/t161cahMAZc?autoplay=0"></iframe> </li>
       </ul>
     </section>


       <section>
         <h4> Cross-Site Scripting (XSS)?</h4>
         <ul style="font-size:30px;">
           <li>When an attacker can insert unauthorized JavaScript or <b>other active content</b> into a web page.</li>
           <li>When other users view the page, the malicious code executes and affects/attacks the user</li>
           <li>Happens when user-supplied input is reflected in the HTML of a web page and the user input is executed as code</li>
           <li>A malicious script can:
             <ul>
               <li>Hijack the user’s session,
                  <li> Submit unauthorized transactions as the user</li>
                  <li> Steal confidential information</li>
                <li>  Simply deface the page.</li>
             </ul>
           </li>
           <li>The poor separation between code (the HTML) and user data (the message) means the injected JavaScript is treated as HTML/JavaScript code
              and the browser executes it
           </li>

         </ul>
       </section>

       <section>
         <h4>Types of XSS</h4>
           <ul style="font-size:35px;">
           <li><b>DOM-based XSS</b>:
              Attack payload is executed as a result of modifying the web page’s document object model (DOM) in the victim user’s browser.
              Web application’s server or database is not involved here.
           </li>
           <li><b>Stored XSS</b>:
               Malicious input is permanently stored on a server ( stored in database and retrieved ) and reflected back to the user in a vulnerable web application.
           </li>
           <li>
             <b>Reflected XSS</b>:
              Malicious input is sent to a server and reflected back to the user on the response page.
              <ul>
                <li>Attacker needs to convince the user to click a link that has the malicious input in it</li>
                <li>Link shorteners, which obfuscate the underlying URL are used to implement this attack</li>
                <li>
                  <pre>
                    <code> https://badsite.com?c=&lt;script&gt;document.cookie()&lt;/script&gt; </code>
                  </pre>
                </li>
              </ul>
           </li>
         </ul>
       </section>

       <section>
         <h4>Impact of XSS </h4>
         <ul style="font-size:30px;">
           <li>An attacker can use XSS to send requests that appear to be from the victim to the web server.</li>
           <li>XSS can prompt the user to <b>download malware</b>. Since the prompt looks like a legitimate request from the site,
             the user may be more likely to trust the request and actually install the malware.</li>
            <li>The attacker can monitor  and <b>log keyboard entries</b>,
               possibly finding <b>usernames and passwords</b> to access accounts at later dates</li>
         </ul>
       </section>


       <section>
         <h4>Common XSS Mitigations</h4>
         <ul style="font-size:30px;">
           <li>
             <b>Input Filtering</b>: If the user inputs <code>&lt;b&gt;Bad&lt;/b&gt;</code>  page strips or blocks the code, then no unauthorized code run:
             <ul>
               <li>
                 <b>Blacklisting</b>:Specific “bad” characters or combinations of characters are banned, meaning they can’t be entered or stored.
                     The developer creates a list of known bad characters (such as HTML or script tags) and
                      throws an error if any bad characters are in the input.
               </li>
               <li>
                 <b>Whitelisting (more secured)</b>:
                 Only characters or words from a known list of entries are permitted, preventing malicious input.
                  For example, if the user enters anything besides numbers in a phone number field, the application throws an error.
               </li>
             </ul>
           </li>

           <li>
             <b>Ouput Encoding</b>:
             Prevents malicious payloads already in the system from executing:
             <ul>
               <li>
                 Server takes all characters that are meaningful in a specific context (HTML, JavaScript, URL) and
                 replaces them with characters that represent its <b>text version</b>.
               </li>
               <li>
                  In the case of the "<" character, you can replace it with the characters "&lt;"
               </li>
               <li>Browser will understand that you want the text version of "<", not the HTML version.</li>
             </ul>
           </li>


         </ul>
       </section>

       <section>
         <h4>XSS prevention in Visualforce and Apex</h4>
          <ul style="font-size:32px;">
            <li> Automatic HTML encoding provided by the platform</li>
            <li>Always encode as close to the rendering context as possible (like in Visualforce)</li>
            <li>
              <b>Visualforce</b>: 3 main encoding functions that developers can use to neutralize potential XSS threats:

              <ol>
                <li>HTMLENCODE -  value is going to be parsed by the HTML parser
                  <code>
                    Hello {!HTMLENCODE(Account.Name)}
                  </code>
                </li>
                <li>JSENCODE - value is going to be parsed by the JavaScript parser
                <code> var x = '{!JSENCODE($CurrentPage.parameters.userInput)}'; </code>
                </li>
                <li>JSINHTMLENCODE : value is combination of both
                    <code>
                      {!JSINHTMLENCODE(Account.Name)}
                    </code>
                </li>

              </ol>

            </li>
            <li>Apex using ESAPI - Lightning Platform ESAPI:
             <code>
                ESAPI.encoder().SFDC_HTMLENCODE(person.Title__c)
             </code>
            </li>
          </ul>

       </section>

       <section>
         <h4>SOQL Injection Prevention </h4>
         <ul style="font-size:35px;">
            <li>Static queries with bind variables: <hr/>
              <pre>
              <code>
    queryResult = [select id from contact where firstname =:var];
    // With a bind variable, the attacker isn’t able to break out and control the SOQL query
              </code>
            </pre>
            </li>
            <li>String.escapeSingleQuotes():  prevent all forms of SOQL injection
              <pre>
              <code>
    whereClause += 'Title__c like  \'%'+ String.escapeSingleQuotes(textualTitle) +'%\' ';
    whereclause_records = database.query(query+' where '+whereClause);
              </code>
            </pre>

            </li>


         </ul>
       </section>


       <section>
         <h4>SOQL Injection Prevention - 2 </h4>
         <ul style="font-size:35px;">

            <li>Type casting -  only effective against non-string input <br/>
              <pre>
              <code>
whereClause +='Age__c >'+string.valueOf(textualAge)+'';
database.query(query+' where '+ whereClause);
              </code>
            </pre>
            </li>
            <li>Replacing characters
              <pre>
                <code>
// The code to remove all spaces from a string can be written as follows
String query = 'select id from user where isActive='+ var.replaceAll('[^\w]','');
                </code>
              </pre>

            </li>


         </ul>
       </section>



              <section>
                <h4>SOQL Injection Prevention - 3 </h4>
                <ul style="font-size:35px;">


                   <li>Whitelisting:
                       Create a list of all “known good” values that the user is allowed to supply.
                       If the user enters anything else, you reject the response.


                   </li>

                </ul>
              </section>

              <section>
                <h4> Cross-Site Request Forgery (CSRF)</h4>
                <ul style="font-size:30px">
                  <li>
                     A <b>malicious application</b> causes a user’s client to perform an unwanted action on <b> a trusted site</b> for which the user is currently authenticated
                  </li>
                  <li>
                     CSRF attacks specifically target <b>state-changing requests</b>,
                     not theft of data, since the attacker has no way to see the response to the forged request.

                  </li>
                  <li>By sending a link via email or chat,  an attacker may trick the users of a web application into executing actions of the attacker's choosing. </li>
                  <li>For a normal user: A successful CSRF attack can force the user to perform state changing requests like transferring funds, changing their email address, and so forth</li>
                  <li> If the victim is an <b>administrative account</b>, CSRF can compromise the entire web application</li>
                </ul>
              </section>

              <section>
                <h4>Sequence</h4>
                <ul style="font-size:30px;">
                  <li>
                    <img  height="400" style="border:0px;" src="img/web_s/csrf.png" alt="">
                  </li>
                  <li>The attacker got the user’s client (the browser) to perform an unwanted actions</li>

                </ul>
              </section>

              <section>
                <h4>Prevention - CSRF</h4>
                  <ul style="font-size:30px;">
                  <li>CSRF requires the targeted user to visit the <b>attack page</b>
                     while authenticated with the targeted service, which often requires coordinated deception on the part of the attacker
                      (this is mostly commonly seen in phishing campaigns).</li>
                  <li>For this attack to succeed, the attacker had to know the <b>exact name of the parameters and also supply the associated values</b></li>
                  <li>If you made the token parameter value <b> a random, unique value that changed on every request</b>, this
                  make it next to impossible for an attacker to guess the current value, preventing the attack  </li>
                  <li>

                    <ol>
                      <li>All sensitive state changing requests (anything performing database operations) must include the token.</li>
                      <li>The token must be unique to the request or user’s session.</li>
                      <li>The token must be difficult to predict (long and random).</li>
                      <li>The token must be validated by the server to ensure the request originated by the intended user</li>
                    </ol>
                  </li>
                </ul>
              </section>

              <section>
                <h4>Salesforce OOTB CSRF prevention </h4>
                <img height="400" style="border:0px;" src="img/web_s/csrf-sfdc.png" alt="">
                <ul style="font-size:25px;">
                  <li>Platform includes a <b>com.salesforce.visualforce.ViewStateCSRF</b> parameter in the form,
                     and that <b>token</b> is validated on submission.</li>
                </ul>
                <img  style="border:0px;" src="img/web_s/csrf-sfdc-token.png" alt="">

              </section>

              <section>
                <h4>Additional tips</h4>
                <ul style="font-size:30px;">
                  <li>
                    To make this
                    <b>com.salesforce.visualforce.ViewStateCSRF</b> paramter kick in:

                   we’ll need to change any outputLink to a commandButton (so the random form parameter will kick in)
                    so when the user clicks the link, it executes Apex code rather than refreshing the page.
                  </li>
                </ul>
              </section>

              <section>
                <h4>Clickjacking</h4>
                <ul style="font-size:30px;">
                  <li>
                    On a clickjacked page, the attacker displays some <b> benign content</b> to the user
                    while it loads <b>another page on top in a transparent layer</b>.
                    On the clickjacked page, the users think they are clicking buttons corresponding to the bottom layer,
                     while they are actually performing actions on the <b> hidden page on top</b>.

                  </li>
                  <li>
                    <img style="border:0px;" height="400" src="img/web_s/Clickjacking_description.png" alt="">
                  </li>
                </ul>
              </section>

              <section>
                <h4>Clickjacking - Prevention</h4>
                <ul style="font-size:30px;">
                  <li><b>Use Frame-Busting Scripts</b>:
                   Prevents an attacker from loading your website in an iFrame.
                    The script attempts to detect if the page is loaded in a frame. If detected, it will prevent the page from loading.
                    <pre>
                      <code> if (top != self) top.location = self.location; </code>
                    </pre>
                </li>
                <li><b>Use X-Frame Options</b>: X-FRAME-OPTIONS:
                  <ul>

                    <li>DENY — Prevents the page from loading in a frame completely.</li>
                    <li>SAMEORIGIN — Allows framing only if the origin is the same as the content (for example, Salesforce.com versus evilsite.com).</li>
                    <li>ALLOW-FROM — Enables framing only from a specific URL.</li>

                  </ul>
                </li>
                </ul>
              </section>



              <section>
                <h4>Common uses of Clickjacking</h4>
                <ul style="font-size:30px;mv ">

                <li>Tricking users into enabling their webcam and microphone through Flash (also known as Cursorjacking).</li>
                <li>Tricking users into making their social networking profile information public.</li>
                <li>Downloading and running malware, enabling a remote attacker to take control of others’ computers.</li>
                <li>Making users follow someone on Twitter.</li>
                <li>Sharing or liking links on Facebook (also known as Likejacking).</li>
                <li>Clicking Google AdSense ads to generate pay-per-click revenue.</li>
                <li>Playing YouTube videos to gain views.</li>
                <li>Following someone on Facebook.</li>

                </ul>
              </section>


              <section>
                <h4>Using Salesforce Clickjacking Protection</h4>
                <img height="350" style="border:0px;" src="img/web_s/csrf-sfdc.png" alt="">
                <ul style="font-size:25px;">
                  <li>Salesforce leverages both frame-busting scripts and the X-Frame Options header as standard clickjacking protection.</li>
                  <li>By default all standard Salesforce pages are protected against clickjacking;
                     however, as a developer you can extend this protection to your custom Visualforce pages. </li>
                </ul>
              </section>



       <section>
         <h4>References</h4>
         <ul style="font-size:32px;">
           <li>
             <a target="_blank" href="https://trailhead.salesforce.com/en/modules/secdev_injection_vulnerabilities/units/secdev_inject_cross_site_scripting">
               Trailhead: Understand Cross-Site Scripting (XSS)
             </a>
           </li>

           <li>
             <a target="_blank" href="https://trailhead.salesforce.com/en/modules/secdev_application_logic_vulnerabilities/units/secdev_app_logic_csrf">
               Trailhead: Prevent Cross-Site Request Forgery (CSRF)
             </a>
           </li>

           <li>
             <a target="_blank" href="https://trailhead.salesforce.com/en/modules/secdev_application_logic_vulnerabilities/units/secdev_app_logic_clickjacking">
               Trailhead: Prevent Clickjacking
             </a>
           </li>



           <li>
             <a target="_blank" href="https://www.owasp.org/index.php/Cross-site_Scripting_(XSS)">OWASP: Cross-site Scripting (XSS)</a>
           </li>
         </ul>
       </section>










    </div>
  </div>



  <script src="../reveal.js/lib/js/head.min.js"></script>
  <script src="../reveal.js/js/reveal.js"></script>


  <script>
    'use strict';


    // Full list of configuration options available at:
    // https://github.com/hakimel/reveal.js#configuration
    Reveal.initialize({

      //width: 960,
      //	height: 700,

      // Display presentation control arrows
      controls: true,

      // Help the user learn the controls by providing hints, for example by
      // bouncing the down arrow when they first encounter a vertical slide
      controlsTutorial: true,

      // Determines where controls appear, "edges" or "bottom-right"
      controlsLayout: 'edges',

      // Visibility rule for backwards navigation arrows; "faded", "hidden"
      // or "visible"
      controlsBackArrows: 'faded',
      // Display a presentation progress bar
      progress: true,

      // Set default timing of 2 minutes per slide
      defaultTiming: 120,

      // Enable keyboard shortcuts for navigation
      keyboard: true,


      history: true,
      center: true,
      slideNumber: true,

      embedded: true,

      transition: 'convex', // none/fade/slide/convex/concave/zoom

      menu: {
        markers: true,
        openSlideNumber: true,
        themes: [{
            name: 'Black',
            theme: '../reveal.js/css/theme/black.css'
          },
          {
            name: 'White',
            theme: '../reveal.js/css/theme/white.css'
          },
          {
            name: 'League',
            theme: '../reveal.js/css/theme/league.css'
          },
          {
            name: 'Sky',
            theme: '../reveal.js/css/theme/sky.css'
          },
          {
            name: 'Beige',
            theme: '../reveal.js/css/theme/beige.css'
          },
          {
            name: 'Simple',
            theme: '../reveal.js/css/theme/simple.css'
          },
          {
            name: 'Serif',
            theme: '../reveal.js/css/theme/serif.css'
          },
          {
            name: 'Blood',
            theme: '../reveal.js/css/theme/blood.css'
          },
          {
            name: 'Night',
            theme: '../reveal.js/css/theme/night.css'
          },
          {
            name: 'Moon',
            theme: '../reveal.js/css/theme/moon.css'
          },
          {
            name: 'Solarized',
            theme: '../reveal.js/css/theme/solarized.css'
          }
        ],
        custom: []
      },

      // Optional reveal.js plugins
      dependencies: [{
          src: '../reveal.js/lib/js/classList.js',
          condition: function() {
            return !document.body.classList;
          }
        },
        {
          src: '../reveal.js/plugin/markdown/marked.js',
          condition: function() {
            return !!document.querySelector('[data-markdown]');
          }
        },
        {
          src: '../reveal.js/plugin/markdown/markdown.js',
          condition: function() {
            return !!document.querySelector('[data-markdown]');
          }
        },
        {
          src: '../reveal.js/plugin/highlight/highlight.js',
          async: true,
          condition: function() {
            return !!document.querySelector('pre code');
          },
          callback: function() {
            hljs.initHighlightingOnLoad();
          }
        },
        {
          src: '../reveal.js/plugin/zoom-js/zoom.js',
          async: true
        },
        {
          src: '../reveal.js/plugin/notes/notes.js',
          async: true
        },
        {
          src: '../reveal.js/plugin/reveal.js-menu/menu.js',
          async: true
        }
      ]
    });



    var app = angular.module('app', [
      'hc.marked'
    ]);
    app.config(['markedProvider', function(markedProvider) {
      markedProvider.setOptions({
        gfm: true
      });
    }]);

    var GSCOPE;
    app.controller('MainCtrl', function($scope, $http, $timeout) {
      GSCOPE = $scope; // debugging purposes
      $scope.appName="Website Security";



    })
  </script>
</body>

</html>
